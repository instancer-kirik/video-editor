<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Editor - Server Status</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #1e1e1e;
            color: #ffffff;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        h1 {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 30px;
        }
        .status-card {
            background: #2d2d2d;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            border-left: 4px solid #4ecdc4;
        }
        .status-good { border-left-color: #4ecdc4; }
        .status-warning { border-left-color: #ffa502; }
        .status-error { border-left-color: #ff4757; }
        .status-icon {
            font-size: 1.5rem;
            margin-right: 10px;
        }
        .test-result {
            padding: 10px 15px;
            margin: 10px 0;
            border-radius: 6px;
            display: flex;
            align-items: center;
        }
        .test-pass {
            background: rgba(78, 205, 196, 0.1);
            border: 1px solid #4ecdc4;
        }
        .test-fail {
            background: rgba(255, 71, 87, 0.1);
            border: 1px solid #ff4757;
        }
        .test-warning {
            background: rgba(255, 165, 2, 0.1);
            border: 1px solid #ffa502;
        }
        .links {
            text-align: center;
            margin: 30px 0;
        }
        .link-btn {
            background: #4ecdc4;
            color: #1e1e1e;
            padding: 15px 25px;
            border-radius: 8px;
            text-decoration: none;
            margin: 0 10px;
            display: inline-block;
            font-weight: 500;
            transition: all 0.3s;
        }
        .link-btn:hover {
            background: #45a085;
            transform: translateY(-2px);
        }
        .link-btn.secondary {
            background: #666;
            color: white;
        }
        .link-btn.secondary:hover {
            background: #777;
        }
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .info-item {
            background: #333;
            padding: 15px;
            border-radius: 8px;
        }
        .info-label {
            color: #4ecdc4;
            font-weight: 500;
            margin-bottom: 5px;
        }
        .refresh-btn {
            background: #4ecdc4;
            border: none;
            color: #1e1e1e;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            margin: 10px 0;
        }
        .refresh-btn:hover {
            background: #45a085;
        }
        .log {
            background: #1a1a1a;
            border: 1px solid #404040;
            border-radius: 6px;
            padding: 15px;
            font-family: monospace;
            font-size: 0.9rem;
            max-height: 200px;
            overflow-y: auto;
            margin: 15px 0;
        }
        .log-entry {
            margin: 3px 0;
            padding: 2px 5px;
        }
        .log-success { color: #4ecdc4; }
        .log-error { color: #ff4757; }
        .log-warning { color: #ffa502; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Server Status & Diagnostics</h1>

        <div class="links">
            <a href="workspace.html" class="link-btn">üé¨ Professional Workspace</a>
            <a href="index_original.html" class="link-btn secondary">üß™ Test Interface</a>
            <a href="/" class="link-btn secondary">üè† Home</a>
        </div>

        <!-- Server Info -->
        <div class="status-card status-good">
            <h2><span class="status-icon">üåê</span>Server Information</h2>
            <div class="info-grid">
                <div class="info-item">
                    <div class="info-label">Server URL</div>
                    <div id="serverUrl">Loading...</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Protocol</div>
                    <div id="protocol">Loading...</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Host</div>
                    <div id="hostname">Loading...</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Port</div>
                    <div id="port">Loading...</div>
                </div>
            </div>
        </div>

        <!-- File Status -->
        <div class="status-card" id="filesCard">
            <h2><span class="status-icon">üìÅ</span>File Status</h2>
            <button class="refresh-btn" onclick="checkFiles()">üîÑ Refresh</button>
            <div id="fileTests">
                <div class="test-result">
                    <span>üîÑ Checking files...</span>
                </div>
            </div>
        </div>

        <!-- Browser Capabilities -->
        <div class="status-card" id="browserCard">
            <h2><span class="status-icon">üåç</span>Browser Capabilities</h2>
            <button class="refresh-btn" onclick="checkBrowser()">üîÑ Refresh</button>
            <div id="browserTests">
                <div class="test-result">
                    <span>üîÑ Checking browser...</span>
                </div>
            </div>
        </div>

        <!-- WASM Status -->
        <div class="status-card" id="wasmCard">
            <h2><span class="status-icon">‚ö°</span>WebAssembly Status</h2>
            <button class="refresh-btn" onclick="checkWasm()">üîÑ Test WASM</button>
            <div id="wasmTests">
                <div class="test-result">
                    <span>üîÑ Ready to test...</span>
                </div>
            </div>
        </div>

        <!-- Camera Status -->
        <div class="status-card" id="cameraCard">
            <h2><span class="status-icon">üé•</span>Camera Status</h2>
            <button class="refresh-btn" onclick="checkCamera()">üîÑ Test Camera</button>
            <div id="cameraTests">
                <div class="test-result">
                    <span>üîÑ Ready to test...</span>
                </div>
            </div>
        </div>

        <!-- System Log -->
        <div class="status-card">
            <h2><span class="status-icon">üìú</span>System Log</h2>
            <button class="refresh-btn" onclick="clearLog()">üóëÔ∏è Clear Log</button>
            <div class="log" id="systemLog">
                <div class="log-entry log-success">System initialized</div>
            </div>
        </div>

        <div class="links">
            <a href="WORKSPACE_README.md" class="link-btn secondary">üìñ Documentation</a>
            <a href="TROUBLESHOOTING.md" class="link-btn secondary">üîß Troubleshooting</a>
        </div>
    </div>

    <script>
        // Logging system
        function log(message, type = 'info') {
            const logDiv = document.getElementById('systemLog');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        function clearLog() {
            document.getElementById('systemLog').innerHTML =
                '<div class="log-entry log-success">Log cleared</div>';
        }

        // Initialize page
        function initializePage() {
            // Server info
            document.getElementById('serverUrl').textContent = window.location.origin;
            document.getElementById('protocol').textContent = window.location.protocol;
            document.getElementById('hostname').textContent = window.location.hostname;
            document.getElementById('port').textContent = window.location.port || '80';

            log('Status page loaded', 'success');

            // Auto-run tests
            setTimeout(checkFiles, 500);
            setTimeout(checkBrowser, 1000);
        }

        // File checks
        async function checkFiles() {
            const testsDiv = document.getElementById('fileTests');
            testsDiv.innerHTML = '<div class="test-result"><span>üîÑ Checking files...</span></div>';

            const files = [
                { name: 'workspace.html', required: true, description: 'Professional workspace interface' },
                { name: 'video-editor.wasm', required: true, description: 'WebAssembly binary (~689KB)' },
                { name: 'index.html', required: false, description: 'Index/redirect page' },
                { name: 'index_original.html', required: false, description: 'Original test interface' }
            ];

            let allGood = true;
            let results = '';

            for (const file of files) {
                try {
                    const response = await fetch(file.name, { method: 'HEAD' });
                    if (response.ok) {
                        const size = response.headers.get('content-length');
                        const sizeText = size ? ` (${Math.round(size/1024)}KB)` : '';
                        results += `<div class="test-result test-pass">
                            <span>‚úÖ ${file.name}${sizeText} - ${file.description}</span>
                        </div>`;
                        log(`File check passed: ${file.name}`, 'success');
                    } else {
                        throw new Error(`HTTP ${response.status}`);
                    }
                } catch (error) {
                    const severity = file.required ? 'test-fail' : 'test-warning';
                    const icon = file.required ? '‚ùå' : '‚ö†Ô∏è';
                    results += `<div class="test-result ${severity}">
                        <span>${icon} ${file.name} - ${error.message} - ${file.description}</span>
                    </div>`;
                    log(`File check ${file.required ? 'failed' : 'warning'}: ${file.name} - ${error.message}`, file.required ? 'error' : 'warning');
                    if (file.required) allGood = false;
                }
            }

            testsDiv.innerHTML = results;
            const card = document.getElementById('filesCard');
            card.className = `status-card ${allGood ? 'status-good' : 'status-error'}`;
        }

        // Browser checks
        function checkBrowser() {
            const testsDiv = document.getElementById('browserTests');
            const tests = [];
            let allGood = true;

            // WebAssembly support
            if (typeof WebAssembly === 'object') {
                tests.push({ pass: true, name: 'WebAssembly Support', message: 'WebAssembly is supported' });
                log('Browser check passed: WebAssembly supported', 'success');
            } else {
                tests.push({ pass: false, name: 'WebAssembly Support', message: 'WebAssembly not supported' });
                log('Browser check failed: WebAssembly not supported', 'error');
                allGood = false;
            }

            // MediaDevices API
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                tests.push({ pass: true, name: 'Camera API', message: 'MediaDevices API available' });
                log('Browser check passed: Camera API available', 'success');
            } else {
                tests.push({ pass: false, name: 'Camera API', message: 'MediaDevices API not available' });
                log('Browser check failed: Camera API not available', 'error');
            }

            // Secure context
            if (window.isSecureContext || location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
                tests.push({ pass: true, name: 'Secure Context', message: 'HTTPS or localhost detected' });
                log('Browser check passed: Secure context', 'success');
            } else {
                tests.push({ pass: false, name: 'Secure Context', message: 'Requires HTTPS or localhost for camera' });
                log('Browser check warning: Non-secure context', 'warning');
            }

            // Canvas 2D
            try {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                if (ctx) {
                    tests.push({ pass: true, name: 'Canvas 2D', message: 'Canvas 2D context available' });
                    log('Browser check passed: Canvas 2D available', 'success');
                } else {
                    throw new Error('Context not available');
                }
            } catch (error) {
                tests.push({ pass: false, name: 'Canvas 2D', message: 'Canvas 2D not available' });
                log('Browser check failed: Canvas 2D not available', 'error');
                allGood = false;
            }

            // Render results
            let results = '';
            tests.forEach(test => {
                const className = test.pass ? 'test-pass' : 'test-fail';
                const icon = test.pass ? '‚úÖ' : '‚ùå';
                results += `<div class="test-result ${className}">
                    <span>${icon} ${test.name} - ${test.message}</span>
                </div>`;
            });

            testsDiv.innerHTML = results;
            const card = document.getElementById('browserCard');
            card.className = `status-card ${allGood ? 'status-good' : 'status-warning'}`;
        }

        // WASM checks
        async function checkWasm() {
            const testsDiv = document.getElementById('wasmTests');
            testsDiv.innerHTML = '<div class="test-result"><span>üîÑ Testing WASM...</span></div>';

            try {
                log('Starting WASM test...', 'info');
                const wasmResponse = await fetch('./video-editor.wasm');

                if (!wasmResponse.ok) {
                    throw new Error(`Failed to fetch WASM: ${wasmResponse.status}`);
                }

                const wasmBytes = await wasmResponse.arrayBuffer();
                log(`WASM file loaded: ${Math.round(wasmBytes.byteLength/1024)}KB`, 'success');

                const wasmObj = await WebAssembly.instantiate(wasmBytes);
                const wasmModule = wasmObj.instance.exports;

                let results = '<div class="test-result test-pass"><span>‚úÖ WASM Binary Loaded</span></div>';

                // Test basic functions
                if (wasmModule.initialize) {
                    wasmModule.initialize();
                    results += '<div class="test-result test-pass"><span>‚úÖ WASM Initialize Function</span></div>';
                    log('WASM initialize function called', 'success');
                } else {
                    results += '<div class="test-result test-warning"><span>‚ö†Ô∏è WASM Initialize Function Missing</span></div>';
                    log('WASM initialize function missing', 'warning');
                }

                if (wasmModule.alloc && wasmModule.free) {
                    results += '<div class="test-result test-pass"><span>‚úÖ WASM Memory Management</span></div>';
                    log('WASM memory management functions found', 'success');
                } else {
                    results += '<div class="test-result test-warning"><span>‚ö†Ô∏è WASM Memory Management Missing</span></div>';
                    log('WASM memory management functions missing', 'warning');
                }

                // Test math function if available
                if (wasmModule.test_basic_math) {
                    const result = wasmModule.test_basic_math();
                    results += `<div class="test-result test-pass"><span>‚úÖ WASM Math Test Result: ${result}</span></div>`;
                    log(`WASM math test result: ${result}`, 'success');
                }

                testsDiv.innerHTML = results;
                document.getElementById('wasmCard').className = 'status-card status-good';
                log('WASM test completed successfully', 'success');

            } catch (error) {
                const errorMsg = `WASM test failed: ${error.message}`;
                testsDiv.innerHTML = `<div class="test-result test-fail"><span>‚ùå ${errorMsg}</span></div>`;
                document.getElementById('wasmCard').className = 'status-card status-error';
                log(errorMsg, 'error');
            }
        }

        // Camera checks
        async function checkCamera() {
            const testsDiv = document.getElementById('cameraTests');
            testsDiv.innerHTML = '<div class="test-result"><span>üîÑ Testing camera...</span></div>';

            try {
                log('Starting camera test...', 'info');

                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    throw new Error('MediaDevices API not available');
                }

                // Request camera permission and stream
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { width: { ideal: 1280 }, height: { ideal: 720 } },
                    audio: true
                });

                let results = '<div class="test-result test-pass"><span>‚úÖ Camera Access Granted</span></div>';

                const videoTracks = stream.getVideoTracks();
                const audioTracks = stream.getAudioTracks();

                if (videoTracks.length > 0) {
                    const track = videoTracks[0];
                    const settings = track.getSettings();
                    results += `<div class="test-result test-pass"><span>‚úÖ Video Track: ${settings.width}x${settings.height}</span></div>`;
                    log(`Camera video track: ${settings.width}x${settings.height}`, 'success');
                }

                if (audioTracks.length > 0) {
                    results += '<div class="test-result test-pass"><span>‚úÖ Audio Track Available</span></div>';
                    log('Camera audio track available', 'success');
                }

                // Stop the stream
                stream.getTracks().forEach(track => track.stop());

                testsDiv.innerHTML = results;
                document.getElementById('cameraCard').className = 'status-card status-good';
                log('Camera test completed successfully', 'success');

            } catch (error) {
                let errorMsg = 'Camera test failed: ';

                if (error.name === 'NotAllowedError') {
                    errorMsg += 'Permission denied';
                } else if (error.name === 'NotFoundError') {
                    errorMsg += 'No camera found';
                } else if (error.name === 'NotSupportedError') {
                    errorMsg += 'Camera not supported';
                } else {
                    errorMsg += error.message;
                }

                testsDiv.innerHTML = `<div class="test-result test-fail"><span>‚ùå ${errorMsg}</span></div>`;
                document.getElementById('cameraCard').className = 'status-card status-error';
                log(errorMsg, 'error');
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializePage);
    </script>
</body>
</html>
